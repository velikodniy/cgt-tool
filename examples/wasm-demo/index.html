<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="UK Capital Gains Tax calculator running in your browser with WebAssembly"
    />
    <title>CGT Calculator - WASM Demo</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div
      class="toast-container"
      id="toastContainer"
      role="status"
      aria-live="polite"
      aria-atomic="true"
    ></div>
    <div class="loading-overlay" id="loadingOverlay">
      <div class="spinner" role="status" aria-label="Loading"></div>
    </div>

    <main class="container">
      <header>
        <h1>CGT Calculator</h1>
        <p class="subtitle">
          UK Capital Gains Tax calculator running in your browser. All calculations are performed
          client-side - your data never leaves your machine.
          <a
            href="#"
            class="link"
            id="helpToggle"
            role="button"
            aria-expanded="false"
            aria-controls="helpBox"
            >Show Syntax Help</a
          >
        </p>
      </header>

      <aside class="help-box" id="helpBox" role="region" aria-label="Syntax Help">
        <h3>DSL Syntax Quick Reference</h3>
        <p style="margin-bottom: 12px">
          All transactions start with a date in <code>YYYY-MM-DD</code> format. Currency defaults to
          GBP if not specified.
        </p>

        <strong>Buy/Sell:</strong>
        <ul>
          <li>
            <code
              >YYYY-MM-DD BUY &lt;ticker&gt; &lt;qty&gt; @ &lt;price&gt; [&lt;currency&gt;] [FEES
              &lt;amount&gt; [&lt;currency&gt;]]</code
            >
          </li>
          <li>
            <code
              >YYYY-MM-DD SELL &lt;ticker&gt; &lt;qty&gt; @ &lt;price&gt; [&lt;currency&gt;] [FEES
              &lt;amount&gt; [&lt;currency&gt;]]</code
            >
          </li>
        </ul>

        <strong>Income Events:</strong>
        <ul>
          <li>
            <code
              >YYYY-MM-DD DIVIDEND &lt;ticker&gt; &lt;shares&gt; TOTAL &lt;value&gt;
              [&lt;currency&gt;] [TAX &lt;amount&gt; [&lt;currency&gt;]]</code
            >
          </li>
          <li>
            <code
              >YYYY-MM-DD CAPRETURN &lt;ticker&gt; &lt;shares&gt; TOTAL &lt;value&gt;
              [&lt;currency&gt;]</code
            >
            - Capital return (reduces cost base)
          </li>
        </ul>

        <strong>Corporate Actions:</strong>
        <ul>
          <li>
            <code>YYYY-MM-DD SPLIT &lt;ticker&gt; RATIO &lt;multiplier&gt;</code> - Stock split
            (e.g., <code>RATIO 4</code> multiplies shares by 4)
          </li>
          <li>
            <code>YYYY-MM-DD UNSPLIT &lt;ticker&gt; RATIO &lt;divisor&gt;</code> - Reverse split
            (divides shares)
          </li>
        </ul>

        <strong>Examples:</strong>
        <ul style="font-family: var(--font-mono); font-size: 12px">
          <li>2024-01-15 BUY AAPL 100 @ 150.00 USD FEES 10.00 USD</li>
          <li>2024-06-20 SELL AAPL 50 @ 180.00 USD FEES 5.00 USD</li>
          <li>2024-09-10 DIVIDEND AAPL 50 TOTAL 25.00 USD TAX 3.75 USD</li>
          <li>2024-05-01 SPLIT AAPL RATIO 4</li>
        </ul>

        <p style="margin-top: 12px; color: var(--color-text-muted)">
          ðŸ’¡ <strong>Tip:</strong> Lines starting with <code>#</code> are comments and will be
          ignored.
        </p>
      </aside>

      <div class="controls">
        <button id="btnReport" class="btn-primary" aria-label="Generate tax report">Report</button>
        <button id="btnCalculate" class="btn-secondary" aria-label="Calculate tax in JSON format">
          Calculate Tax (JSON)
        </button>
        <button id="btnParse" class="btn-secondary" aria-label="Parse transactions">
          Parse Transactions
        </button>
        <button id="btnValidate" class="btn-tertiary" aria-label="Validate DSL syntax">
          Validate DSL
        </button>

        <div class="year-controls">
          <label class="checkbox-wrapper">
            <input type="checkbox" id="yearCheckbox" checked aria-describedby="yearInputDesc" />
            <span>Specific year:</span>
          </label>
          <input
            type="number"
            id="taxYear"
            class="year-input"
            placeholder="e.g., 2024"
            min="2015"
            max="2030"
            value="2024"
            aria-label="Tax year"
          />
          <span id="yearInputDesc" class="hidden"
            >Enter a specific tax year to calculate, or uncheck to calculate all years</span
          >
        </div>

        <a href="#" class="link" id="exampleLink" role="button">Load Example</a>
      </div>

      <div class="grid">
        <section class="section">
          <label for="input" class="section-label">Transaction Input</label>
          <textarea
            id="input"
            aria-label="Transaction input"
            placeholder="Enter your transactions here, e.g.:
2024-01-15 BUY AAPL 10 @ 150.00 USD
2024-06-20 SELL AAPL 5 @ 180.00 USD"
          ></textarea>
        </section>

        <section class="section">
          <label for="output" class="section-label">Results</label>
          <div
            id="output"
            class="output"
            role="region"
            aria-live="polite"
            aria-label="Calculation results"
          ></div>
        </section>
      </div>
    </main>

    <script type="module" src="app.js"></script>
  </body>
</html>
