# Test: WithAssetEventsMultipleYears
# Purpose: Validates Section 104 pooling with capital returns across multiple tax years
# Rules Tested: Section 104 Pooling, Capital Returns (CAPRETURN)
# Complexity: Complex
# Key Features: Multi-year (2018-2020), capital returns reducing cost base, no B&B matches
# Expected Outcome: Tax Year 2019/20 - Gain £60 (first sale), then £540 (second sale) = £600 total
#
# Verification Status: Verified
# Verified By: Manual calculation 2025-12-08
# Verification Notes: See detailed verification below
#
# === DETAILED VERIFICATION ===
#
# CHRONOLOGICAL ORDER:
# 1. 2018-08-29: BUY 20 @ £10 + £0 expenses
# 2. 2019-03-15: BUY 20 @ £10 + £0 expenses
# 3. 2019-05-31: CAPRETURN 40 shares, £50 total (reduces cost base)
# 4. 2019-05-31: ACCUMULATION 40 shares, £70 (no CGT impact)
# 5. 2019-12-01: SELL 40 @ £12 - £0 expenses
# 6. 2020-02-01: BUY 100 @ £20 + £0 expenses
# 7. 2020-05-31: CAPRETURN 100 shares, £140 total (reduces cost base)
# 8. 2020-05-31: ACCUMULATION 100 shares, £100 (no CGT impact)
# 9. 2020-06-01: SELL 100 @ £25 - £0 expenses
#
# === VERIFICATION (GOLDEN OUTPUT) ===
#
# - 2019-12-01 SELL (tax year 2019/20): proceeds £480, allowable cost £420, gain £60
# - 2020-06-01 SELL (tax year 2020/21): proceeds £2,500, allowable cost £1,960, gain £540
#
# This fixture includes CAPRETURN events to validate cost base handling across tax years.
#
# Note: golden outputs are per tax year; the two disposals fall into different tax years.
# === END DETAILED VERIFICATION ===
#
2018-08-29 BUY GB00B3TYHH97 20 @ 10 FEES 0
2019-03-15 BUY GB00B3TYHH97 20 @ 10 FEES 0
2019-05-31 CAPRETURN GB00B3TYHH97 40 TOTAL 50 FEES 0
2019-05-31 ACCUMULATION GB00B3TYHH97 40 TOTAL 70 TAX 0
2019-12-01 SELL GB00B3TYHH97 40 @ 12 FEES 0
2020-02-01 BUY GB00B3TYHH97 100 @ 20 FEES 0
2020-05-31 CAPRETURN GB00B3TYHH97 100 TOTAL 140 FEES 0
2020-05-31 ACCUMULATION GB00B3TYHH97 100 TOTAL 100 TAX 0
2020-06-01 SELL GB00B3TYHH97 100 @ 25 FEES 0
